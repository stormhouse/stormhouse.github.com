<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>python中的字符编码</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="python中的字符编码"/>
            <meta property="og:url" content="http://stormhouse.github.io/posts/2013/pythonzhong-de-zi-fu-bian-ma/"/>
            <meta property="og:description" content="上篇字符编码对字符编码做了简单的介绍，除了演示几个简单的例子外，没有将字符编码与编程语言，看本文的标题相信就明白，这是与伟大的python结合一些实例（python版本为2.7.5）。 准备工作，去码表（GB2312, Unicode, UTF-8）查取编码的GB2312和Unicode字符集编码及按gb2312和utf-8编码方式保存的二进制。注意，要亲自查一下 哦～～ 编码 对应十六进制 GB2312字符集： b1e0 c2eb GB2312编码(同上): b1e0 c2eb Unicode字符集： 7f16 7801 UTF-16编码(同上): 7f16 7801 UTF-8编码 ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://stormhouse.github.io/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://stormhouse.github.io/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://stormhouse.github.io/theme/css/bootstrap-glyphicons.css" rel="stylesheet">
    <link href="http://stormhouse.github.io/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="http://stormhouse.github.io/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

        <link href="http://stormhouse.github.io/feeds/all.rss.xml" type="application/atom+xml" rel="alternate"
              title="stormhouse RSS Feed"/>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://stormhouse.github.io" class="navbar-brand">stormhouse</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://stormhouse.github.io/category/python.html">python</a>
                        </li>
                        <li >
                            <a href="http://stormhouse.github.io/category/javascript.html">javascript</a>
                        </li>
                        <li >
                            <a href="http://stormhouse.github.io/category/git.html">git</a>
                        </li>
                        <li class="active">
                            <a href="http://stormhouse.github.io/category/encoding.html">encoding</a>
                        </li>
                        <li >
                            <a href="http://stormhouse.github.io/category/animation.html">animation</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://stormhouse.github.io/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://stormhouse.github.io/posts/2013/pythonzhong-de-zi-fu-bian-ma/"
                       rel="bookmark"
                       title="Permalink to python中的字符编码">
                        python中的字符编码
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Thu 21 November 2013
    </span>



<span class="label label-default">Tags</span>
	<a href="http://stormhouse.github.io/tag/encoding.html">encoding</a>
        /
	<a href="http://stormhouse.github.io/tag/python.html">python</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>上篇<a href="http://stormhouse.github.io/posts/2013/zi-fu-bian-ma/">字符编码</a>对字符编码做了简单的介绍，除了演示几个简单的例子外，没有将<code>字符编码</code>与<code>编程语言</code>，看本文的标题相信就明白，这是与伟大的python结合一些实例（python版本为2.7.5）。</p>
<p>准备工作，去码表（<a href="http://ash.jp/code/cn/gb2312tbl.htm">GB2312</a>, <a href="http://www.tamasoft.co.jp/en/general-info/unicode.html">Unicode</a>, <a href="http://www.moransoft.com/chinesecode.html">UTF-8</a>）查取<code>编码</code>的GB2312和Unicode字符集编码及按gb2312和utf-8编码方式保存的二进制。注意，要亲自查一下 哦～～</p>
<div class="highlight"><pre><span class="err">编码</span>                  <span class="err">对应十六进制</span>
<span class="n">GB2312</span><span class="err">字符集：</span>        <span class="n">b1e0</span> <span class="n">c2eb</span>
<span class="n">GB2312</span><span class="err">编码</span><span class="p">(</span><span class="err">同上</span><span class="p">)</span><span class="o">:</span>     <span class="n">b1e0</span> <span class="n">c2eb</span>
<span class="n">Unicode</span><span class="err">字符集：</span>       <span class="mf">7f</span><span class="mi">16</span> <span class="mi">7801</span>
<span class="n">UTF</span><span class="o">-</span><span class="mi">16</span><span class="err">编码</span><span class="p">(</span><span class="err">同上</span><span class="p">)</span><span class="o">:</span>     <span class="mf">7f</span><span class="mi">16</span> <span class="mi">7801</span>
<span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="err">编码</span><span class="o">:</span>            <span class="n">e7bc96</span> <span class="n">e7a081</span>
</pre></div>


<h3>字符串操作</h3>
<p>话不多说，打开python解释器，输入：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="err">&#39;编码&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="err">&#39;\</span><span class="n">xb1</span><span class="err">\</span><span class="n">xe0</span><span class="err">\</span><span class="n">xc2</span><span class="err">\</span><span class="n">xeb</span><span class="err">&#39;</span>
</pre></div>


<p>将结果与码表查得的结果，对应着GB2312字符集。为什么呢？继续：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">import</span> <span class="n">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="p">.</span><span class="n">getdefaultencoding</span><span class="p">()</span> <span class="err">#返回当前系统所使用的默认字符编码</span>
<span class="err">&#39;</span><span class="n">ascii</span><span class="err">&#39;</span>
</pre></div>


<p>除一些IDE外，python是按操作系统默认字符编码来处理的。这里是ascii。</p>
<p>python支持unicode：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="err">&#39;编码&#39;</span> <span class="err">#</span><span class="n">unicode</span><span class="err">编码</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span>
<span class="n">u</span><span class="err">&#39;\</span><span class="n">u7f16</span><span class="err">\</span><span class="n">u7801</span><span class="err">&#39;</span>
</pre></div>


<p>utf-8：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="err">&#39;编码&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span>
<span class="n">u</span><span class="err">&#39;\</span><span class="n">u7f16</span><span class="err">\</span><span class="n">u7801</span><span class="err">&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">unicode</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="err">&#39;\</span><span class="n">xe7</span><span class="err">\</span><span class="n">xbc</span><span class="err">\</span><span class="n">x96</span><span class="err">\</span><span class="n">xe7</span><span class="err">\</span><span class="n">xa0</span><span class="err">\</span><span class="n">x81</span><span class="err">&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">str</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u1</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u1</span>
<span class="n">u</span><span class="err">&#39;\</span><span class="n">u7f16</span><span class="err">\</span><span class="n">u7801</span><span class="err">&#39;</span>
</pre></div>


<p>综上，可与查得的结果相同。</p>
<p>python中的str，unicode对象：</p>
<ul>
<li>str: str对象其实就是"8-bit string" ，字节字符串，本质上类似java中的byte[]。decode</li>
<li>unicode: unicode对象应该才是等同于java中的String对象，或本质上是java的char[]。encode</li>
</ul>
<p>unicode才是真正意义上的字符串：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="err">&#39;编码&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="mi">4</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="err">&#39;编码&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="mi">2</span>
</pre></div>


<p>详细请参见<a href="http://www.cnblogs.com/huxi/archive/2010/12/05/1897271.html">python的str，unicode对象的encode和decode方法</a></p>
<h3>文件操作</h3>
<h6>读文件</h6>
<p>内置的open()方法打开文件时，read()读取的是str，读取后需要使用正确的编码格式进行decode()。</p>
<p>如保存为ascii格式的文本文件encoding-ascii.txt，内容为'编码'。对该文本读取：</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">encoding</span><span class="o">-</span><span class="n">ascii</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="err">#</span><span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">str</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>      <span class="err">#编码</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">gb2312</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="err">#</span><span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">unicode</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="n">print</span> <span class="n">u</span>       <span class="err">#编码</span>
</pre></div>


<p>上面是正确的编码处理方式。假如读取保存为utf-8格式的文件encoding-utf8.txt会出现什么情况：</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">encoding</span><span class="o">-</span><span class="n">utf8</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="err">#</span><span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">str</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>      <span class="err">#锘跨紪鐮</span>     <span class="p">(</span><span class="err">乱码</span><span class="p">)</span>


<span class="n">u</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">gb2312</span><span class="err">&#39;</span><span class="p">)</span> <span class="err">#报错。正确方式：</span><span class="n">s</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">&#39;</span><span class="p">)</span>
<span class="cp"># UnicodeDecodeError: &#39;gb2312&#39; codec can&#39;t decode bytes in position 4-5: llegal multibyte sequence</span>
<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> 
<span class="n">print</span> <span class="n">u</span>
</pre></div>


<p>故正确处理方式为：<br />
使用codecs模块中的open方法，可指定编码方式打开文件，该方法返回的是unicode（注意：内置open返回的是str）：</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>

<span class="n">import</span> <span class="n">codecs</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">encoding</span><span class="o">-</span><span class="n">utf8</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="err">&#39;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="err">#</span><span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">unicode</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="n">print</span> <span class="n">repr</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="err">#</span><span class="n">u</span><span class="err">&#39;\</span><span class="n">u7f16</span><span class="err">\</span><span class="n">u7801</span><span class="err">&#39;</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">gb2312</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="err">#</span><span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">str</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="n">print</span> <span class="n">s</span>       <span class="err">#编码</span>
</pre></div>


<h6>写文件</h6>
<p>内置的write()写入时，如果参数是unicode，则需要使用你希望写入的编码进行encode()，如果是其他编码格式的str，则需要先用该str的编码进行decode()，转成unicode后再使用写入的编码进行encode()。如果直接将unicode作为参数传入write()方法，Python将先使用源代码文件声明的字符编码进行编码然后写入。</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="err">&#39;编码&#39;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">test</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;w&#39;</span><span class="p">)</span>
<span class="cp"># 编码成UTF-8编码的str</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">gb2312</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>查看test.txt文件，可得保存的格式为ascii。</p>
<p>codecs模块写入时，如果参数是unicode，则使用open()时指定的编码进行编码后写入；如果是str，则先根据源代码文件声明的字符编码，解码成unicode后再进行前述操作。相对内置的open()来说，这个方法比较不容易在编码上出现问题。</p>
<div class="highlight"><pre><span class="cp">#coding=utf-8</span>

<span class="n">import</span> <span class="n">codecs</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="err">&#39;编码&#39;</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">codecs</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">test1</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="err">&#39;</span><span class="n">gb2312</span><span class="err">&#39;</span><span class="p">)</span> <span class="err">#</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<span class="cp"># 写入unicode</span>
<span class="n">f1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="n">print</span> <span class="n">type</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>

<span class="cp"># 写入str，自动进行解码编码操作(貌似没法自动转化TODO)</span>
<span class="cp"># GBK编码的str</span>
<span class="n">s</span> <span class="o">=</span> <span class="sc">&#39;汉&#39;</span>
<span class="n">print</span> <span class="n">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="err">#</span> <span class="err">&#39;\</span><span class="n">xba</span><span class="err">\</span><span class="n">xba</span><span class="err">&#39;</span>
<span class="cp"># 这里会先将GBK编码的str解码为unicode再编码为UTF-8写入</span>
<span class="n">f1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">&#39;</span><span class="p">))</span>
<span class="n">f1</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h3>网络(HTTP)操作</h3>
<p>[传送门][]</p>
<h3>sys/locale模块关于编码相关的方法</h3>
<div class="highlight"><pre><span class="kr">import</span> <span class="nx">sys</span>
<span class="kr">import</span> <span class="nx">locale</span>

<span class="nx">def</span> <span class="nx">p</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s1">&#39;%s.%s(): %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">__module__</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">__name__</span><span class="p">,</span> <span class="nx">f</span><span class="p">())</span>

<span class="err">#</span> <span class="err">返回当前系统所使用的默认字符编码</span>
<span class="nx">p</span><span class="p">(</span><span class="nx">sys</span><span class="p">.</span><span class="nx">getdefaultencoding</span><span class="p">)</span>

<span class="err">#</span> <span class="err">返回用于转换</span><span class="nx">Unicode</span><span class="err">文件名至系统文件名所使用的编码</span>
<span class="nx">p</span><span class="p">(</span><span class="nx">sys</span><span class="p">.</span><span class="nx">getfilesystemencoding</span><span class="p">)</span>

<span class="err">#</span> <span class="err">获取默认的区域设置并返回元祖</span><span class="p">(</span><span class="err">语言</span><span class="p">,</span> <span class="err">编码</span><span class="p">)</span>
<span class="nx">p</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">getdefaultlocale</span><span class="p">)</span>

<span class="err">#</span> <span class="err">返回用户设定的文本数据编码</span>
<span class="err">#</span> <span class="err">文档提到</span><span class="k">this</span> <span class="kd">function</span> <span class="nx">only</span> <span class="nx">returns</span> <span class="nx">a</span> <span class="nx">guess</span>
<span class="nx">p</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">getpreferredencoding</span><span class="p">)</span>

<span class="err">#</span> <span class="err">\</span><span class="nx">xba</span><span class="err">\</span><span class="nx">xba</span><span class="err">是</span><span class="s1">&#39;汉&#39;</span><span class="err">的</span><span class="nx">GBK</span><span class="err">编码</span>
<span class="err">#</span> <span class="nx">mbcs</span><span class="err">是不推荐使用的编码，这里仅作测试表明为什么不应该用</span>
<span class="nx">print</span> <span class="nx">r</span><span class="s2">&quot;&#39;\xba\xba&#39;.decode(&#39;mbcs&#39;):&quot;</span><span class="p">,</span> <span class="nx">repr</span><span class="p">(</span><span class="s1">&#39;\xba\xba&#39;</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="s1">&#39;mbcs&#39;</span><span class="p">))</span>

<span class="err">#在笔者的</span><span class="nx">Windows</span><span class="err">上的结果</span><span class="p">(</span><span class="err">区域设置为中文</span><span class="p">(</span><span class="err">简体</span><span class="p">,</span> <span class="err">中国</span><span class="p">))</span>
<span class="err">#</span><span class="nx">sys</span><span class="p">.</span><span class="nx">getdefaultencoding</span><span class="p">()</span><span class="o">:</span> <span class="nx">ascii</span>
<span class="err">#</span><span class="nx">sys</span><span class="p">.</span><span class="nx">getfilesystemencoding</span><span class="p">()</span><span class="o">:</span> <span class="nx">mbcs</span>
<span class="err">#</span><span class="nx">locale</span><span class="p">.</span><span class="nx">getdefaultlocale</span><span class="p">()</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">,</span> <span class="s1">&#39;cp936&#39;</span><span class="p">)</span>
<span class="err">#</span><span class="nx">locale</span><span class="p">.</span><span class="nx">getpreferredencoding</span><span class="p">()</span><span class="o">:</span> <span class="nx">cp936</span>
<span class="err">#</span><span class="s1">&#39;\xba\xba&#39;</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="s1">&#39;mbcs&#39;</span><span class="p">)</span><span class="o">:</span> <span class="nx">u</span><span class="s1">&#39;\u6c49&#39;</span>
</pre></div>


<h3>总结</h3>
<ul>
<li>使用字符编码声明，并且同一工程中的所有源代码文件使用相同的字符编码声明。</li>
<li>抛弃str，全部使用unicode。<code>u = u'编码'</code></li>
<li>使用codecs.open()替代内置的open()。</li>
<li>绝对需要<code>避免</code>使用的字符编码：MBCS/DBCS和UTF-16。</li>
</ul>
<p>这里说的MBCS不是指GBK什么的都不能用，而是不要使用Python里名为'MBCS'的编码，除非程序完全不移植。<br />
Python中编码'MBCS'与'DBCS'是同义词，指当前Windows环境中MBCS指代的编码。Linux的Python实现中没有这种编码，所以一旦移植到Linux一定会出现异常！另外，只要设定的Windows系统区域不同，MBCS指代的编码也是不一样的。</p>
<h6>MBCS</h6>
<p>计算机世界里很快就有了其他语言，单字节的ASCII已无法满足需求。后来每个语言就制定了一套自己的编码，由于单字节能表示的字符太少，而且同时也需要与ASCII编码保持兼容，所以这些编码纷纷使用了多字节来表示字符，如GBxxx、BIGxxx等等，他们的规则是，如果第一个字节是\x80以下，则仍然表示ASCII字符；而如果是\x80以上，则跟下一个字节一起（共两个字节）表示一个字符，然后跳过下一个字节，继续往下判断。</p>
<p>这里，IBM发明了一个叫Code Page的概念，将这些编码都收入囊中并分配页码，GBK是第936页，也就是CP936。所以，也可以使用CP936表示GBK。</p>
<p>MBCS(Multi-Byte Character Set)是这些编码的统称。目前为止大家都是用了双字节，所以有时候也叫做DBCS(Double-Byte Character Set)。必须明确的是，MBCS并不是某一种特定的编码，Windows里根据你设定的区域不同，MBCS指代不同的编码，而Linux里无法使用MBCS作为编码。在Windows中你看不到MBCS这几个字符，因为微软为了更加洋气，使用了ANSI来吓唬人，记事本的另存为对话框里编码ANSI就是MBCS。同时，在简体中文Windows默认的区域设定里，指代GBK。</p>
<h3>参拷</h3>
<ul>
<li><a href="http://www.cnblogs.com/huxi/archive/2010/12/05/1897271.html">Python字符编码详解</a></li>
<li><a href="http://appofis.iteye.com/blog/443206">python的str，unicode对象的encode和decode方法</a></li>
<li><a href="http://docs.python.org/2/library/codecs.html#standard-encodings">Standard Encodings</a></li>
</ul>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'stormhouse'; // required: replace example with your forum shortname
            var disqus_identifier = 'pythonzhong-de-zi-fu-bian-ma';
            var disqus_url = 'http://stormhouse.github.io/posts/2013/pythonzhong-de-zi-fu-bian-ma/';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="http://coolshell.cn/"><i
                            class="icon-酷壳-sign icon-large"></i>酷壳
                    </a></li>
                    <li class="list-group-item"><a href="http://blog.zhaojie.me/"><i
                            class="icon-老赵-sign icon-large"></i>老赵
                    </a></li>
                    <li class="list-group-item"><a href="http://www.ruanyifeng.com/about.html"><i
                            class="icon-阮一峰-sign icon-large"></i>阮一峰
                    </a></li>
                    <li class="list-group-item"><a href="http://www.cnblogs.com/rubylouvre/"><i
                            class="icon-rubylouvre-sign icon-large"></i>rubylouvre
                    </a></li>
                    <li class="list-group-item"><a href="http://nuysoft.com/"><i
                            class="icon-nuysoft-sign icon-large"></i>nuysoft
                    </a></li>
                    <li class="list-group-item"><a href="http://jinlong.github.io/"><i
                            class="icon-涂鸦码龙-sign icon-large"></i>涂鸦码龙
                    </a></li>
                    <li class="list-group-item"><a href="http://www.diguage.com/"><i
                            class="icon-地瓜哥-sign icon-large"></i>地瓜哥
                    </a></li>



            <li class="list-group-item"><a href="http://stormhouse.github.io/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item tag-0">
                    <a href="http://stormhouse.github.io/tag/python.html">
                        python
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="http://stormhouse.github.io/tag/encoding.html">
                        encoding
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://stormhouse.github.io/tag/animation.html">
                        animation
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://stormhouse.github.io/tag/http.html">
                        http
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://stormhouse.github.io/tag/event.html">
                        event
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://stormhouse.github.io/tag/tomcat.html">
                        tomcat
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://stormhouse.github.io/tag/git.html">
                        git
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://stormhouse.github.io/tag/javascript.html">
                        javascript
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://stormhouse.github.io/tag/base64.html">
                        base64
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://stormhouse.github.io/tag/url.html">
                        url
                    </a>
                </li>
        </ul>
    </section>
</aside>        </div>
    </div>
</div>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://stormhouse.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://stormhouse.github.io/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'stormhouse'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
</body>
</html>